# Wide search data automatic generation agent

wide search,针对互联网信息的广泛搜索。训练模型的数据，主要是用提前获取的封闭信息表，比如奥运冠军信息、世界银行统计数据、联合国统计数据等，构造问答，让模型根据标准答案表做RL训练。

这是一个辅助的小agent，在获取信息表后，可以通过该agent，根据表格数据结构，灵活构造QA实现自动生产，生产效率比单纯的工作流要高。

可惜在我写完前，项目已经黄了，写完做个纪念吧。

## 功能特性

- 📊 **CSV文件读取**：获取文件基本信息（行列数、列名、数据类型等）
- 🔍 **数据筛选**：支持多种条件筛选（数值比较、文本匹配等）  
- 🧮 **数据计算**：支持求和、平均值、计数、最大最小值等统计操作
- 📝 **安全写入**：仅支持追加写入，保护原始数据安全
- 🔄 **智能循环**：自动处理复杂的多步骤任务
- 🔧 **工具调用**：支持OpenAI格式的函数调用，LLM可以直接调用工具

## 安装

1. 克隆项目到本地
2. 安装依赖：
```bash
pip install -r requirements.txt
```

## 配置

### 命令行参数

```bash
python main.py <csv文件> <用户需求> [选项]

选项：
  --max-rounds INT     最大工作轮次 (默认: 10)
  --provider model_name  LLM模型名称 
  --api-key KEY        API密钥（也可通过环境变量设置）
  --output FILE        输出文件路径（默认: wide_search_QA.csv）
```

## 使用示例

```bash
python3 main.py "1901年至1969年诺贝尔获奖情况.csv" "开始工作" \
--max-rounds 30 \
--provider "ep……" \
--api-key "……" \
--output "wide_search_QA.csv"

```

## 工具说明

### 1. read_csv_info - CSV文件信息读取
- **功能**：读取CSV文件的基本信息
- **参数**：`file_path` - CSV文件路径
- **返回**：行列数、列名、数据类型、示例数据

### 2. filter_csv_data - 数据筛选
- **功能**：根据条件筛选CSV数据
- **参数**：
  - `file_path` - CSV文件路径
  - `column` - 要筛选的列名
  - `operator` - 操作符（=, !=, >, <, >=, <=, contains）
  - `value` - 筛选值
- **返回**：筛选结果数据

### 3. calculate_csv_data - 数据计算
- **功能**：对CSV数据进行统计计算
- **参数**：
  - `file_path` - CSV文件路径
  - `column` - 要计算的列名
  - `operation` - 计算操作（sum, avg, count, min, max）
  - `filter_column` - 筛选列名（可选）
  - `filter_value` - 筛选值（可选）
- **返回**：计算结果

### 4. write_to_csv - 数据写入
- **功能**：将数据写入CSV文件（仅支持追加）
- **参数**：
  - `file_path` - 目标CSV文件路径
  - `data` - 要写入的数据，每行是一个数组
  - `headers` - 列标题数组（可选）
- **返回**：写入结果信息

### 5. task_done - 任务完成
- **功能**：标记任务完成，结束agent工作流程
- **参数**：`message` - 任务完成信息
- **返回**：完成状态

## 注意事项

1. **数据安全**：写入操作只能追加，不能覆盖或删除原有数据
2. **API限制**：请确保有足够的API调用额度
3. **文件格式**：仅支持标准CSV格式文件
4. **编码支持**：支持UTF-8编码的CSV文件
5. **工具调用**：LLM现在可以直接调用工具函数，无需依赖文本解析

## 错误处理

- 文件不存在时会提示错误
- API调用失败会显示具体错误信息
- 数据格式错误会给出详细提示
- 工具函数执行异常会捕获并报告

## 扩展开发

如需添加新的工具函数：

1. 在`tools`文件夹中创建新的工具模块
2. 在`tools/__init__.py`中注册工具
3. 更新`tools.json`中的工具描述
4. 在系统提示词中添加相关说明

## 许可证

MIT License